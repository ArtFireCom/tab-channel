!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.TabChannel=n():e.TabChannel=n()}(window,function(){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}();var r="TcMsg_oo_";function a(e){for(var n="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=0;o<(e||5);o++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}var i=function(){function e(n){if(function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),!window.localStorage)throw new Error("localStorage not available");if(!n)throw new Error("channel name required");this.name=n,this.channelId=n,this.handler=function(e){var n=e.key,t=e.newValue,o=null;if(n.indexOf(r)>-1&&t){try{o=JSON.parse(t)}catch(e){this.onmessageerror(e)}if(o.instanceId!==this.instanceId&&o.channelId===this.channelId&&!this.closed){var a=o.isJSON?JSON.parse(o.message):o.message;this.onmessage({data:a}),setTimeout(function(){window.localStorage.removeItem(n)},1e3)}}}.bind(this),this.instanceId=a(),window.addEventListener("storage",this.handler,!1)}return o(e,[{key:"postMessage",value:function(e){if(this.closed)this.onmessageerror(new Error("channel closed"));else{var n={channelId:this.channelId,instanceId:this.instanceId,isJSON:"string"!=typeof e,message:"string"==typeof e?e:JSON.stringify(e)},t=r+a()+"_"+this.channelId;try{var o=JSON.stringify(n);window.localStorage.setItem(t,o);var i=document.createEvent("StorageEvent");i.initStorageEvent("storage",!1,!1,t,null,o,window.location.href,window.localStorage),window.dispatchEvent(i)}catch(e){this.onmessageerror(e)}setTimeout(function(){window.localStorage.removeItem(t)},1e3)}}},{key:"close",value:function(){this.closed=!0,window.removeEventListener("storage",this.handler)}},{key:"onmessage",value:function(){}},{key:"onmessageerror",value:function(){}}]),e}();n.default=window.BroadcastChannel||i}])});